groups:
  - name: event-pipeline-alerts
    rules:
      - alert: HighConsumerLag
        expr: consumer_lag > 1000
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Consumer lag is too high"
          description: "Consumer lag has been above 1000 for more than 5 minutes. Current value: {{ $value }}"
      
      - alert: HighProcessingLatency
        expr: histogram_quantile(0.95, rate(processing_latency_seconds_bucket[5m])) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Processing latency is high"
          description: "95th percentile processing latency has been above 5 seconds for more than 5 minutes"
      
      - alert: HighDLQRate
        expr: rate(signals_dlq_total[5m]) > 10
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High DLQ rate detected"
          description: "DLQ rate has been above 10 messages/second for more than 2 minutes"
      
      - alert: DatabaseWriteFailures
        expr: rate(db_write_failures_total[5m]) > 1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Database write failures detected"
          description: "Database write failures detected at rate: {{ $value }}/second"
